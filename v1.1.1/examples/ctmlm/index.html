<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Cloud Topped Mixed Layer Model · ConceptualClimateModels.jl</title><meta name="title" content="Cloud Topped Mixed Layer Model · ConceptualClimateModels.jl"/><meta property="og:title" content="Cloud Topped Mixed Layer Model · ConceptualClimateModels.jl"/><meta property="twitter:title" content="Cloud Topped Mixed Layer Model · ConceptualClimateModels.jl"/><meta name="description" content="Documentation for ConceptualClimateModels.jl."/><meta property="og:description" content="Documentation for ConceptualClimateModels.jl."/><meta property="twitter:description" content="Documentation for ConceptualClimateModels.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="https://fonts.googleapis.com/css?family=Montserrat|Source+Code+Pro&amp;display=swap" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ConceptualClimateModels.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><a class="tocitem" href="../../tutorial/">Tutorial</a></li><li><span class="tocitem">Submodules</span><ul><li><a class="tocitem" href="../../submodules/globalmeanebm/">Global mean EBM</a></li><li><a class="tocitem" href="../../submodules/ctmlm/">Cloud Topped Mixed Layer Model</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../globalmeanebm/">Global mean EBM</a></li><li class="is-active"><a class="tocitem" href>Cloud Topped Mixed Layer Model</a><ul class="internal"><li><a class="tocitem" href="#Fixed-states-of-Stevens-2006"><span>Fixed states of Stevens 2006</span></a></li><li><a class="tocitem" href="#Adding-clouds"><span>Adding clouds</span></a></li><li><a class="tocitem" href="#Climate-change-scenario:-increasing-SST"><span>Climate change scenario: increasing SST</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Cloud Topped Mixed Layer Model</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Cloud Topped Mixed Layer Model</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaDynamics/ConceptualClimateModels.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaDynamics/ConceptualClimateModels.jl/blob/main/docs/src/examples/ctmlm.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="ctmlm_examples"><a class="docs-heading-anchor" href="#ctmlm_examples">CloudToppedMixedLayerModel</a><a id="ctmlm_examples-1"></a><a class="docs-heading-anchor-permalink" href="#ctmlm_examples" title="Permalink"></a></h1><pre><code class="language-julia hljs">using DynamicalSystems, ConceptualClimateModels
import ConceptualClimateModels.CloudToppedMixedLayerModel as CTMLM</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Precompiling DynamicalSystems...
   1853.8 ms  ? DiffEqBase
   1247.1 ms  ? DiffEqBase → DiffEqBaseChainRulesCoreExt
   1315.9 ms  ? DiffEqBase → DiffEqBaseForwardDiffExt
   1430.0 ms  ? DiffEqBase → DiffEqBaseMeasurementsExt
   1505.3 ms  ? DiffEqBase → DiffEqBaseSparseArraysExt
   1843.9 ms  ? DiffEqBase → DiffEqBaseDistributionsExt
   1176.9 ms  ? OrdinaryDiffEqCore
    666.8 ms  ? OrdinaryDiffEqCore → OrdinaryDiffEqCoreEnzymeCoreExt
    665.7 ms  ? OrdinaryDiffEqTsit5
   1589.7 ms  ? DynamicalSystemsBase
   1129.6 ms  ? Attractors
   1210.3 ms  ? ChaosTools
   1214.1 ms  ? PredefinedDynamicalSystems
Info Given DynamicalSystems was explicitly requested, output will be shown live 
┌ Warning: Module DynamicalSystemsBase with build ID ffffffff-ffff-ffff-2932-4fe4f54132dc is missing from the cache.
│ This may mean DynamicalSystemsBase [6e36e845-645a-534a-86f2-f5d4aa5a06b4] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
   1095.1 ms  ? DynamicalSystems
┌ Warning: Module DynamicalSystemsBase with build ID ffffffff-ffff-ffff-2932-4fe4f54132dc is missing from the cache.
│ This may mean DynamicalSystemsBase [6e36e845-645a-534a-86f2-f5d4aa5a06b4] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
Precompiling DiffEqBaseMeasurementsExt...
   1791.8 ms  ? DiffEqBase
Info Given DiffEqBaseMeasurementsExt was explicitly requested, output will be shown live 
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-0382-96b11dc327db is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
    704.2 ms  ? DiffEqBase → DiffEqBaseMeasurementsExt
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-0382-96b11dc327db is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
Precompiling PredefinedDynamicalSystems...
   1778.9 ms  ? DiffEqBase
   1067.4 ms  ? DiffEqBase → DiffEqBaseForwardDiffExt
   1122.8 ms  ? OrdinaryDiffEqCore
   1262.6 ms  ? DiffEqBase → DiffEqBaseSparseArraysExt
    685.5 ms  ? OrdinaryDiffEqCore → OrdinaryDiffEqCoreEnzymeCoreExt
    658.8 ms  ? OrdinaryDiffEqTsit5
   1586.5 ms  ? DynamicalSystemsBase
Info Given PredefinedDynamicalSystems was explicitly requested, output will be shown live 
┌ Warning: Module DynamicalSystemsBase with build ID ffffffff-ffff-ffff-2932-4fe4f54132dc is missing from the cache.
│ This may mean DynamicalSystemsBase [6e36e845-645a-534a-86f2-f5d4aa5a06b4] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
    792.5 ms  ? PredefinedDynamicalSystems
┌ Warning: Module DynamicalSystemsBase with build ID ffffffff-ffff-ffff-2932-4fe4f54132dc is missing from the cache.
│ This may mean DynamicalSystemsBase [6e36e845-645a-534a-86f2-f5d4aa5a06b4] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
Precompiling Attractors...
   1799.9 ms  ? DiffEqBase
   1061.3 ms  ? DiffEqBase → DiffEqBaseForwardDiffExt
   1301.6 ms  ? DiffEqBase → DiffEqBaseSparseArraysExt
   1528.6 ms  ? DiffEqBase → DiffEqBaseDistributionsExt
   1593.0 ms  ? OrdinaryDiffEqCore
    694.9 ms  ? OrdinaryDiffEqCore → OrdinaryDiffEqCoreEnzymeCoreExt
    678.0 ms  ? OrdinaryDiffEqTsit5
   1573.9 ms  ? DynamicalSystemsBase
Info Given Attractors was explicitly requested, output will be shown live 
┌ Warning: Module DynamicalSystemsBase with build ID ffffffff-ffff-ffff-2932-4fe4f54132dc is missing from the cache.
│ This may mean DynamicalSystemsBase [6e36e845-645a-534a-86f2-f5d4aa5a06b4] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
   1130.6 ms  ? Attractors
┌ Warning: Module DynamicalSystemsBase with build ID ffffffff-ffff-ffff-2932-4fe4f54132dc is missing from the cache.
│ This may mean DynamicalSystemsBase [6e36e845-645a-534a-86f2-f5d4aa5a06b4] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
Precompiling AttractorsVisualizations...
   1774.7 ms  ? DiffEqBase
   1230.0 ms  ? DiffEqBase → DiffEqBaseForwardDiffExt
   1292.9 ms  ? DiffEqBase → DiffEqBaseUnitfulExt
   1335.7 ms  ? DiffEqBase → DiffEqBaseChainRulesCoreExt
   1531.9 ms  ? DiffEqBase → DiffEqBaseSparseArraysExt
   1796.5 ms  ? DiffEqBase → DiffEqBaseDistributionsExt
   1212.9 ms  ? OrdinaryDiffEqCore
    683.7 ms  ? OrdinaryDiffEqCore → OrdinaryDiffEqCoreEnzymeCoreExt
    677.7 ms  ? OrdinaryDiffEqTsit5
   1566.5 ms  ? DynamicalSystemsBase
   1103.6 ms  ? Attractors
Info Given AttractorsVisualizations was explicitly requested, output will be shown live 
┌ Warning: Module Attractors with build ID ffffffff-ffff-ffff-4a1b-fd491f3f4bfc is missing from the cache.
│ This may mean Attractors [f3fd9213-ca85-4dba-9dfd-7fc91308fec7] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
    698.4 ms  ? Attractors → AttractorsVisualizations
┌ Warning: Module Attractors with build ID ffffffff-ffff-ffff-4a1b-fd491f3f4bfc is missing from the cache.
│ This may mean Attractors [f3fd9213-ca85-4dba-9dfd-7fc91308fec7] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
Precompiling ChaosTools...
   1814.8 ms  ? DiffEqBase
   1200.1 ms  ? DiffEqBase → DiffEqBaseMeasurementsExt
   1268.6 ms  ? DiffEqBase → DiffEqBaseForwardDiffExt
   1557.8 ms  ? DiffEqBase → DiffEqBaseSparseArraysExt
   1805.1 ms  ? DiffEqBase → DiffEqBaseDistributionsExt
   1814.1 ms  ? OrdinaryDiffEqCore
    689.1 ms  ? OrdinaryDiffEqCore → OrdinaryDiffEqCoreEnzymeCoreExt
    680.4 ms  ? OrdinaryDiffEqTsit5
   1574.7 ms  ? DynamicalSystemsBase
Info Given ChaosTools was explicitly requested, output will be shown live 
┌ Warning: Module DynamicalSystemsBase with build ID ffffffff-ffff-ffff-2932-4fe4f54132dc is missing from the cache.
│ This may mean DynamicalSystemsBase [6e36e845-645a-534a-86f2-f5d4aa5a06b4] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
    787.1 ms  ? ChaosTools
┌ Warning: Module DynamicalSystemsBase with build ID ffffffff-ffff-ffff-2932-4fe4f54132dc is missing from the cache.
│ This may mean DynamicalSystemsBase [6e36e845-645a-534a-86f2-f5d4aa5a06b4] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
Precompiling DynamicalSystemsVisualizations...
   1783.6 ms  ? DiffEqBase
   1212.4 ms  ? DiffEqBase → DiffEqBaseForwardDiffExt
   1315.9 ms  ? DiffEqBase → DiffEqBaseMeasurementsExt
   1367.1 ms  ? DiffEqBase → DiffEqBaseChainRulesCoreExt
   1482.4 ms  ? DiffEqBase → DiffEqBaseSparseArraysExt
   2121.9 ms  ? DiffEqBase → DiffEqBaseDistributionsExt
   1024.5 ms  ? DiffEqBase → DiffEqBaseUnitfulExt
   1186.1 ms  ? OrdinaryDiffEqCore
    685.4 ms  ? OrdinaryDiffEqCore → OrdinaryDiffEqCoreEnzymeCoreExt
    688.1 ms  ? OrdinaryDiffEqTsit5
   1584.2 ms  ? DynamicalSystemsBase
    788.5 ms  ? ChaosTools
   1059.7 ms  ? PredefinedDynamicalSystems
   1403.4 ms  ? Attractors
    689.8 ms  ? Attractors → AttractorsVisualizations
   1122.5 ms  ? DynamicalSystems
Info Given DynamicalSystemsVisualizations was explicitly requested, output will be shown live 
┌ Warning: Module DynamicalSystems with build ID ffffffff-ffff-ffff-823e-45682b8f527f is missing from the cache.
│ This may mean DynamicalSystems [61744808-ddfa-5f27-97ff-6e42cc95d634] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
    677.8 ms  ? DynamicalSystems → DynamicalSystemsVisualizations
┌ Warning: Module DynamicalSystems with build ID ffffffff-ffff-ffff-823e-45682b8f527f is missing from the cache.
│ This may mean DynamicalSystems [61744808-ddfa-5f27-97ff-6e42cc95d634] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541</code></pre><h2 id="Fixed-states-of-Stevens-2006"><a class="docs-heading-anchor" href="#Fixed-states-of-Stevens-2006">Fixed states of Stevens 2006</a><a id="Fixed-states-of-Stevens-2006-1"></a><a class="docs-heading-anchor-permalink" href="#Fixed-states-of-Stevens-2006" title="Permalink"></a></h2><p>Here we want to recreate the same bulk boundary layer model defined in (<a href="../../references/#Stevens2006">Stevens, 2006</a>), equations 31-33.</p><pre><code class="language-julia hljs">const cₚ = 1004.0 # heat capacity at constant pressure (J/K/kg)

eqs = [
    CTMLM.mlm_dynamic(),
    CTMLM.entrainment_velocity(:Stevens2006; use_augmentation = false),
    ## Figure 1 and Sec. 4.2 provide these values:
    CTMLM.s₊ ~ 301200.0/cₚ,
    CTMLM.q₊ ~ 1.56,
    CTMLM.s₀ ~ CTMLM.s₊ - 12.5,
    CTMLM.ρ₀ ~ 1,
    CTMLM.q₀ ~ CTMLM.q_saturation(288.96 + 1.25),
    CTMLM.ΔF_s ~ 40.0
]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">8-element Vector{Any}:
 TimeDerivative[TimeDerivative(z_b(t), -w_m(t) + w_e(t) - D*z_b(t), LiteralParameter{Float64}(1.1574074074074073e-5)), TimeDerivative(s_b(t), -1.1574074074074073e-5s_x(t) + ((0.00099601593625498(SHF(t) - ΔF_s(t))) / ρ₀(t) + Δ₊s(t)*w_e(t)) / z_b(t), LiteralParameter{Float64}(1.1574074074074073e-5)), TimeDerivative(q_b(t), -1.1574074074074073e-5q_x(t) + ((-ΔF_q(t) + LHF(t)) / (2530.0ρ₀(t)) + Δ₊q(t)*w_e(t)) / z_b(t), LiteralParameter{Float64}(1.1574074074074073e-5))]
 w_e(t) ~ (e_e*ΔF_s(t)) / (1004.0Δ₊s(t)*ρ₀(t))
 s₊(t) ~ 300.0
 q₊(t) ~ 1.56
 s₀(t) ~ -12.5 + s₊(t)
 ρ₀(t) ~ 1
 q₀(t) ~ 12.404970818808321
 ΔF_s(t) ~ 40.0</code></pre><p>We now give these equations to the main function that creates a <code>DynamicalSystem</code> from the processes (and we also provide <code>CTMLM</code> to obtain default processes from)</p><pre><code class="language-julia hljs">ds = processes_to_coupledodes(eqs, CTMLM)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">3-dimensional CoupledODEs
 deterministic: true
 discrete time: false
 in-place:      false
 dynamic rule:  GeneratedFunctionWrapper
 ODE solver:    Tsit5
 ODE kwargs:    (abstol = 1.0e-6, reltol = 1.0e-6)
 parameters:    [0.9, 3.0e-6, 0.0012, 6.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
 time:          0.0
 state:         [11.0, 290.0, 1200.0]
</code></pre><p>We also make sure to use the same parameter values as in the paper:</p><pre><code class="language-julia hljs">set_parameter!(ds, :D, 4e-6)
set_parameter!(ds, :d_c, 0.0011)
set_parameter!(ds, :U, 0.008/0.0011) # U*d_c = 0.008
set_parameter!(ds, :e_e, 1.0) # effective emissivity</code></pre><p>And that&#39;s all. We can run the system to its steady state:</p><pre><code class="language-julia hljs">step!(ds, 100.0)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">3-dimensional CoupledODEs
 deterministic: true
 discrete time: false
 in-place:      false
 dynamic rule:  GeneratedFunctionWrapper
 ODE solver:    Tsit5
 ODE kwargs:    (abstol = 1.0e-6, reltol = 1.0e-6)
 parameters:    [1.0, 4.0e-6, 0.0011, 7.2727272727272725, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
 time:          100.10196159861358
 state:         [9.315240208837562, 287.4999999999997, 796.8127490039915]
</code></pre><p>leading to a steady state with height <span>$z_b$</span> (<span>$h_\infty$</span> in (<a href="../../references/#Stevens2006">Stevens, 2006</a>)) of about 800 meters as in the paper. Extracting the variable <span>$\sigma$</span> of Eq. 38 is also very easy:</p><pre><code class="language-julia hljs">Δs = CTMLM.s₊ - CTMLM.s₀ # symbolic variable not existing in the graph of the `ds`
σ = observe_state(ds, CTMLM.V * Δs / CTMLM.ΔF_s * cₚ)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2.5100000000000002</code></pre><p>and we get the same value (note multiplication by <code>cₚ</code>, because <code>s</code> is in units of K).</p><p>If you want to see a list of all equations that compose the dynamical system then do</p><pre><code class="language-julia hljs">all_equations(ds)</code></pre><p class="math-container">\[ \begin{align}
\frac{\mathrm{d} \mathtt{q\_b}\left( t \right)}{\mathrm{d}t} &amp;=  - 86400 \left( 1.1574 \cdot 10^{-5} \mathtt{q\_x}\left( t \right) + \frac{\frac{\mathtt{{\Delta}F\_q}\left( t \right) - \mathtt{LHF}\left( t \right)}{2530 \mathtt{\rho_0}\left( t \right)} - \mathtt{\Delta.q}\left( t \right) \mathtt{w\_e}\left( t \right)}{\mathtt{z\_b}\left( t \right)} \right) \\
\frac{\mathrm{d} \mathtt{s\_b}\left( t \right)}{\mathrm{d}t} &amp;=  - 86400 \left( \frac{\frac{ - 0.00099602 \left( \mathtt{SHF}\left( t \right) - \mathtt{{\Delta}F\_s}\left( t \right) \right)}{\mathtt{\rho_0}\left( t \right)} - \mathtt{\Delta.s}\left( t \right) \mathtt{w\_e}\left( t \right)}{\mathtt{z\_b}\left( t \right)} + 1.1574 \cdot 10^{-5} \mathtt{s\_x}\left( t \right) \right) \\
\frac{\mathrm{d} \mathtt{z\_b}\left( t \right)}{\mathrm{d}t} &amp;=  - 86400 \left( \mathtt{w\_m}\left( t \right) - \mathtt{w\_e}\left( t \right) + D \mathtt{z\_b}\left( t \right) \right) \\
\mathtt{\rho_0}\left( t \right) &amp;= 1 \\
\mathtt{s.}\left( t \right) &amp;= 300 \\
\mathtt{{\Delta}F\_s}\left( t \right) &amp;= 40 \\
\mathtt{q_0}\left( t \right) &amp;= 12.405 \\
V\left( t \right) &amp;= U \mathtt{d\_c} \\
\mathtt{q\_x}\left( t \right) &amp;= 0 \\
\mathtt{s\_x}\left( t \right) &amp;= 0 \\
\mathtt{w\_m}\left( t \right) &amp;= 0 \\
\mathtt{{\Delta}F\_q}\left( t \right) &amp;= 0 \\
\mathtt{q.}\left( t \right) &amp;= 1.56 \\
\mathtt{\Delta.s}\left( t \right) &amp;=  - \mathtt{s\_b}\left( t \right) + \mathtt{s.}\left( t \right) \\
\mathtt{s_0}\left( t \right) &amp;= -12.5 + \mathtt{s.}\left( t \right) \\
\mathtt{\Delta_{0}q}\left( t \right) &amp;= \mathtt{q\_b}\left( t \right) - \mathtt{q_0}\left( t \right) \\
\mathtt{\Delta.q}\left( t \right) &amp;=  - \mathtt{q\_b}\left( t \right) + \mathtt{q.}\left( t \right) \\
\mathtt{w\_e}\left( t \right) &amp;= \frac{\mathtt{e\_e} \mathtt{{\Delta}F\_s}\left( t \right)}{1004 \mathtt{\Delta.s}\left( t \right) \mathtt{\rho_0}\left( t \right)} \\
\mathtt{\Delta_{0}s}\left( t \right) &amp;= \mathtt{s\_b}\left( t \right) - \mathtt{s_0}\left( t \right) \\
\mathtt{LHF}\left( t \right) &amp;=  - 2530 \mathtt{\Delta_{0}q}\left( t \right) V\left( t \right) \mathtt{\rho_0}\left( t \right) \\
\mathtt{SHF}\left( t \right) &amp;=  - 1004 V\left( t \right) \mathtt{\rho_0}\left( t \right) \mathtt{\Delta_{0}s}\left( t \right)
\end{align}
 \]</p><p>In the compiled documentation these render via LaTeX but running this in the REPL won&#39;t be as pretty :)</p><h2 id="Adding-clouds"><a class="docs-heading-anchor" href="#Adding-clouds">Adding clouds</a><a id="Adding-clouds-1"></a><a class="docs-heading-anchor-permalink" href="#Adding-clouds" title="Permalink"></a></h2><p>We can add clouds to the mixed layer model using the same decoupling-based approach as in (<a href="../../references/#Datseris2025">Datseris, 2025</a>) (while keeping SST a fixed boundary condition) just by including a couple more equations to the ones already defined, so that <span>$C, \mathcal{D}$</span> have a process assigned to them. We will also augment <code>ΔF</code> to be partially proportional to <code>C</code> using a very simple ad-hoc approach.</p><pre><code class="language-julia hljs">eqs = [
    CTMLM.mlm_dynamic(),
    CTMLM.entrainment_velocity(:Stevens2006; use_augmentation = false),
    ## Cloud stuff
    CTMLM.cf_dynamic(),
    CTMLM.decoupling_variable(),
    CTMLM.cloud_base_height(:Bolton1980),
    CTMLM.CTRC ~ 10 + 40*CTMLM.C, # cloud top radiative cooling
    CTMLM.ΔF_s ~ CTMLM.CTRC, # same equation
    ## rest the same
    CTMLM.s₊ ~ 301200.0/cₚ,
    CTMLM.q₊ ~ 1.56,
    CTMLM.s₀ ~ CTMLM.s₊ - 12.5,
    CTMLM.ρ₀ ~ 1,
    CTMLM.q₀ ~ CTMLM.q_saturation(288.96 + 1.25),
]

ds = processes_to_coupledodes(eqs, CTMLM)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">4-dimensional CoupledODEs
 deterministic: true
 discrete time: false
 in-place:      false
 dynamic rule:  GeneratedFunctionWrapper
 ODE solver:    Tsit5
 ODE kwargs:    (abstol = 1.0e-6, reltol = 1.0e-6)
 parameters:    [0.9, 3.0e-6, 1.0, 0.2, 1.0, 0.5, 100.0, 2.0, 0.0012, 6.0  …  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
 time:          0.0
 state:         [11.0, 290.0, 1200.0, 1.0]
</code></pre><p>And we run the model to a steady state:</p><pre><code class="language-julia hljs">set_parameter!(ds, :D, 4e-6)
set_parameter!(ds, :d_c, 0.0009)
set_parameter!(ds, :U, 6.8) # U*d_c = 0.008
set_parameter!(ds, :e_e, 1.0) # effective emissivity

step!(ds, 100.0)
observe_state.(ds, (:z_b, :q_b, :s_b, :C)) # get state variables by name</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(763.5014057710669, 8.794700233030296, 287.50000000000017, 0.7081938746297317)</code></pre><h2 id="Climate-change-scenario:-increasing-SST"><a class="docs-heading-anchor" href="#Climate-change-scenario:-increasing-SST">Climate change scenario: increasing SST</a><a id="Climate-change-scenario:-increasing-SST-1"></a><a class="docs-heading-anchor-permalink" href="#Climate-change-scenario:-increasing-SST" title="Permalink"></a></h2><p>If you want to study multistability for alternate cloud states (Cumulus vs Stratocumulus), or perform continuations (like the climate change scenarios in (<a href="../../references/#Datseris2025">Datseris, 2025</a>)), visit the documentation of Attractors.jl.</p><p>As a brief example we will perform a simple climate change scenario where SST increases with a constant rate. First, we modify the equations so that <code>s₀, q₀</code> are derived from a prescribed SST:</p><pre><code class="language-julia hljs">@parameters SST = 290.0
eqs = [
    CTMLM.mlm_dynamic(),
    CTMLM.entrainment_velocity(:Stevens2006; use_augmentation = false),
    ## Cloud stuff
    CTMLM.cf_dynamic(),
    CTMLM.decoupling_variable(),
    CTMLM.cloud_base_height(:Bolton1980),
    CTMLM.CTRC ~ 10 + 40*CTMLM.C, # cloud top radiative cooling
    CTMLM.ΔF_s ~ CTMLM.CTRC, # same equation
    ## Usage of SST
    CTMLM.s₀ ~ SST,
    CTMLM.q₀ ~ CTMLM.q_saturation(SST),
    ## rest the same
    CTMLM.s₊ ~ 301200.0/cₚ,
    CTMLM.q₊ ~ 1.56,
    CTMLM.ρ₀ ~ 1,
]

ds = processes_to_coupledodes(eqs, CTMLM)
set_parameter!(ds, :D, 4e-6)
set_parameter!(ds, :d_c, 0.0009)
set_parameter!(ds, :U, 6.8) # U*d_c = 0.008
set_parameter!(ds, :e_e, 1.0) # effective emissivity
ds</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">4-dimensional CoupledODEs
 deterministic: true
 discrete time: false
 in-place:      false
 dynamic rule:  GeneratedFunctionWrapper
 ODE solver:    Tsit5
 ODE kwargs:    (abstol = 1.0e-6, reltol = 1.0e-6)
 parameters:    [1.0, 290.0, 4.0e-6, 1.0, 0.2, 1.0, 0.5, 100.0, 2.0, 0.0009  …  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
 time:          0.0
 state:         [11.0, 290.0, 1200.0, 1.0]
</code></pre><p>To perform global continuation we need to create an attractor mapper, which we create here by tessellating the state space. Have a look at the Attractors.jl tutorial if the next few lines of code are puzzling to you</p><pre><code class="language-julia hljs">grid = (
    (1:1.0:25), # specific humidity
    (270:5.0:330), # static energy
    (0:100.0:3000), # height
    (0:0.1:1), # cloud fraction
)

sampler, = statespace_sampler(grid)

mapper = AttractorsViaRecurrences(ds, grid)
ascm = AttractorSeedContinueMatch(mapper)

fs = basins_fractions(mapper, sampler; show_progress = false)
attractors = extract_attractors(mapper)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Dict{Int64, StateSpaceSet{4, Float64, SVector{4, Float64}}} with 1 entry:
  1 =&gt; 4-dimensional StateSpaceSet{Float64} with 1 points</code></pre><p>with the <code>sampler, mapper, ascm</code> data structures in order, we can easily now run a global continuation with changing SST:</p><pre><code class="language-julia hljs">prange = 290:1:310
pidx = :SST
fractions_cont, attractors_cont = global_continuation(ascm, prange, pidx, sampler; show_progress = false)
attractors_cont</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">21-element Vector{Dict{Int64, StateSpaceSet{4, Float64, SVector{4, Float64}}}}:
 Dict(1 =&gt; 4-dimensional StateSpaceSet{Float64} with 1 points)
 Dict(1 =&gt; 4-dimensional StateSpaceSet{Float64} with 1 points)
 Dict(1 =&gt; 4-dimensional StateSpaceSet{Float64} with 1 points)
 Dict(1 =&gt; 4-dimensional StateSpaceSet{Float64} with 1 points)
 Dict(1 =&gt; 4-dimensional StateSpaceSet{Float64} with 1 points)
 Dict(1 =&gt; 4-dimensional StateSpaceSet{Float64} with 1 points)
 Dict(1 =&gt; 4-dimensional StateSpaceSet{Float64} with 4 points)
 Dict(1 =&gt; 4-dimensional StateSpaceSet{Float64} with 1 points)
 Dict(1 =&gt; 4-dimensional StateSpaceSet{Float64} with 1 points)
 Dict()
 ⋮
 Dict()
 Dict()
 Dict()
 Dict()
 Dict()
 Dict()
 Dict()
 Dict()
 Dict()</code></pre><p>if you are not sure what the output means, no worries, just have a look at the Attractors.jl documentation. Here we visualize the cloud fraction:</p><pre><code class="language-julia hljs">using CairoMakie

# cloud fraction and height values of last point on the attractor
varvalues = [A -&gt; A[end][4], A -&gt; A[end][3]]

fig = plot_basins_attractors_curves(
	fractions_cont, attractors_cont, varvalues, prange,
)
content(fig[2,1]).ylabel = &quot;C&quot;
content(fig[3,1]).ylabel = &quot;z_b&quot;
fig</code></pre><img src="b738ec20.png" alt="Example block output"/><p>we see for our ad hoc parameterizations, the dynamical system has no stable states for SST &gt; 297. Before that cloud fraction decreases very fast from a Stratocumulus state to a Cumulus one.</p><p>The model diverges due to the definition of the entrainment velocity (which is proportional to <code>ΔF_s/Δ₊s</code>) in combination with a fixed <code>s₊</code>: the model reaches a state where <code>Δ₊s</code> is so small that height increases unnaturally well beyond the state space tessellation we defined.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../globalmeanebm/">« Global mean EBM</a><a class="docs-footer-nextpage" href="../../references/">References »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Thursday 28 August 2025 16:07">Thursday 28 August 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
